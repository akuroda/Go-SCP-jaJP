ストアドプロシージャ
=================

ストアドプロシージャを使用すると、クエリに対して特定のビューを作成し、機密情報がアーカイブされないようにすることができます。

ストアドプロシージャを作成し、アクセスを制限することで、誰が特定のストアドプロシージャを使用できるか、誰がどの種類の情報にアクセスできるかを区別するためのインターフェイスが追加されます。
これによって特にテーブルやカラムをセキュリティの観点から制御するプロセスがより簡単に管理できます。

例を見てみましょう。

ユーザーのパスポートIDを含む情報を持つテーブルがあるとします。

このようなクエリを使用します。

```SQL
SELECT * FROM tblUsers WHERE userId = $user_input
```

[入力のバリデーション][1]の問題は置いておくとして、データベースのユーザー(例：John)は、ユーザーIDを使って全ての情報にアクセスすることができます。

もし、Johnがこのストアドプロシージャを使用する権限しか持っていないとしたらどうでしょう。

```SQL
CREATE PROCEDURE db.getName @userId int = NULL
AS
    SELECT name, lastname FROM tblUsers WHERE userId = @userId
GO
```

これだけで実行できます。

```
EXEC db.getName @userId = 14
```

この方法によって、ユーザー John がリクエストしたユーザーの `name` と `lastname` のみを見れることを確信できます。

ストアドプロシージャは盾ではありませんが、ウェブアプリケーションを保護するための新しいレイヤーを作成することができます。
ストアドプロシージャはDBAに、パーミッション制御 (例: ユーザーを特定の行やデータに制限する) とサパフォーマンスも向上に利益をもたらします。

[1]: /input-validation/README.md
